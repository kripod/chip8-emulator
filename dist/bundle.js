!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=1)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(3),o=n(a),u=i(4),c=i(5),l=n(c),h=i(6),d=n(h),f=i(7),v=n(f),p=i(8),y=function(){function e(){r(this,e),this.v=new Uint8Array(16),this.keyboard=new l.default,this.display=new o.default,this.speaker=new v.default,this.reset()}return s(e,[{key:"reset",value:function(){this.v.fill(0),this.i=0,this.pc=512,this.stack=[],this.delayTimer=0,this.memory=new d.default,this.display.reset(),this.speaker.reset()}},{key:"loadROM",value:function(e){this.memory.set(e,h.MEMORY_OFFSET_PROGRAM)}},{key:"emulateCycle",value:function(){this.decodeOpcode()()}},{key:"updateTimers",value:function(){this.delayTimer>0&&(this.delayTimer-=1),this.speaker.emulateCycle()}},{key:"fetchOpcode",value:function(){return this.memory[this.pc]<<8|this.memory[this.pc+1]}},{key:"decodeOpcode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fetchOpcode();switch(61440&e){case 0:switch(4095&e){case 224:return this.executeCls.bind(this);case 238:return this.executeRet.bind(this);default:throw new u.OpcodeError(e)}case 4096:return this.executeJumpAddress.bind(this,4095&e);case 8192:return this.executeCallAddress.bind(this,4095&e);case 12288:return this.executeSkipEqVxValue.bind(this,(3840&e)>>8,255&e);case 16384:return this.executeSkipNeVxValue.bind(this,(3840&e)>>8,255&e);case 20480:if(15&e)throw new u.OpcodeError(e);return this.executeSkipEqVxVy.bind(this,(3840&e)>>8,(240&e)>>4);case 24576:return this.executeLoadVxValue.bind(this,(3840&e)>>8,255&e);case 28672:return this.executeAddVxValue.bind(this,(3840&e)>>8,255&e);case 32768:var t=(3840&e)>>8,i=(240&e)>>4;switch(15&e){case 0:return this.executeLoadVxVy.bind(this,t,i);case 1:return this.executeOrVxVy.bind(this,t,i);case 2:return this.executeAndVxVy.bind(this,t,i);case 3:return this.executeXorVxVy.bind(this,t,i);case 4:return this.executeAddVxVy.bind(this,t,i);case 5:return this.executeSubVxVy.bind(this,t,i);case 6:if(i)throw new u.OpcodeError(e);return this.executeShrVx.bind(this,t);case 7:return this.executeDifVxVy.bind(this,t,i);case 14:if(240&e)throw new u.OpcodeError(e);return this.executeShlVx.bind(this,t);default:throw new u.OpcodeError(e)}case 36864:if(15&e)throw new u.OpcodeError(e);return this.executeSkipNeVxVy.bind(this,(3840&e)>>8,(240&e)>>4);case 40960:return this.executeLoadIAddress.bind(this,4095&e);case 45056:return this.executeJumpAddressV0.bind(this,4095&e);case 49152:return this.executeRndVxValue.bind(this,(3840&e)>>8,255&e);case 53248:return this.executeDrawVxVyHeight.bind(this,(3840&e)>>8,(240&e)>>4,15&e);case 57344:var n=(3840&e)>>8;switch(255&e){case 158:return this.executeSkipEqVxKey.bind(this,n);case 161:return this.executeSkipNeVxKey.bind(this,n);default:throw new u.OpcodeError(e)}case 61440:var r=(3840&e)>>8;switch(255&e){case 7:return this.executeLoadVxDelayTimer.bind(this,r);case 10:return this.executeLoadVxKey.bind(this,r);case 21:return this.executeLoadDelayTimerVx.bind(this,r);case 24:return this.executeLoadSoundTimerVx.bind(this,r);case 30:return this.executeAddIVx.bind(this,r);case 41:return this.executeHexVx.bind(this,r);case 51:return this.executeBcdVx.bind(this,r);case 85:return this.executeSaveVx.bind(this,r);case 101:return this.executeRestoreVx.bind(this,r);default:throw new u.OpcodeError(e)}default:throw new u.OpcodeError(e)}}},{key:"executeCls",value:function(){this.display.reset(),this.pc+=2}},{key:"executeRet",value:function(){this.pc=this.stack.pop()+2}},{key:"executeJumpAddress",value:function(e){this.pc=e}},{key:"executeCallAddress",value:function(e){this.stack.push(this.pc),this.executeJumpAddress(e)}},{key:"executeSkipEqVxValue",value:function(e,t){this.pc+=this.v[e]===t?4:2}},{key:"executeSkipNeVxValue",value:function(e,t){this.pc+=this.v[e]!==t?4:2}},{key:"executeSkipEqVxVy",value:function(e,t){this.pc+=this.v[e]===this.v[t]?4:2}},{key:"executeLoadVxValue",value:function(e,t){this.v[e]=t,this.pc+=2}},{key:"executeAddVxValue",value:function(e,t){this.v[e]+=t,this.pc+=2}},{key:"executeLoadVxVy",value:function(e,t){this.v[e]=this.v[t],this.pc+=2}},{key:"executeOrVxVy",value:function(e,t){this.v[e]|=this.v[t],this.pc+=2}},{key:"executeAndVxVy",value:function(e,t){this.v[e]&=this.v[t],this.pc+=2}},{key:"executeXorVxVy",value:function(e,t){this.v[e]^=this.v[t],this.pc+=2}},{key:"executeAddVxVy",value:function(e,t){var i=this.v[e]+this.v[t];this.v[e]=i,this.v[15]=i>255?1:0,this.pc+=2}},{key:"executeSubVxVy",value:function(e,t){var i=this.v[e]-this.v[t];this.v[e]=i,this.v[15]=i>=0?1:0,this.pc+=2}},{key:"executeShrVx",value:function(e){this.v[15]=1&this.v[e],this.v[e]>>=1,this.pc+=2}},{key:"executeDifVxVy",value:function(e,t){var i=this.v[t]-this.v[e];this.v[e]=i,this.v[15]=i>=0?1:0,this.pc+=2}},{key:"executeShlVx",value:function(e){this.v[15]=255&this.v[e],this.v[e]<<=1,this.pc+=2}},{key:"executeSkipNeVxVy",value:function(e,t){this.pc+=this.v[e]!==this.v[t]?4:2}},{key:"executeLoadIAddress",value:function(e){this.i=e,this.pc+=2}},{key:"executeJumpAddressV0",value:function(e){this.executeJumpAddress(e+this.v[0])}},{key:"executeRndVxValue",value:function(e,t){this.v[e]=(0,p.getRandomInt)(0,256)&t,this.pc+=2}},{key:"executeDrawVxVyHeight",value:function(e,t,i){var n=this;this.v[15]=0,this.memory.slice(this.i,this.i+i).forEach(function(i,r){for(var s=0;s<8;s+=1)i&128>>s&&(n.v[15]|=n.display.getPixel(s+n.v[e],r+n.v[t]),n.display.flipPixel(s+n.v[e],r+n.v[t]))}),this.pc+=2}},{key:"executeSkipEqVxKey",value:function(e){this.pc+=this.keyboard.pressedKeys.has(this.v[e])?4:2}},{key:"executeSkipNeVxKey",value:function(e){this.pc+=this.keyboard.pressedKeys.has(this.v[e])?2:4}},{key:"executeLoadVxDelayTimer",value:function(e){this.v[e]=this.delayTimer,this.pc+=2}},{key:"executeLoadVxKey",value:function(e){var t=this.keyboard.getLatestPressedKey();null!=t&&(this.v[e]=t,this.pc+=2)}},{key:"executeLoadDelayTimerVx",value:function(e){this.delayTimer=this.v[e],this.pc+=2}},{key:"executeLoadSoundTimerVx",value:function(e){this.speaker.soundTimer=this.v[e],this.pc+=2}},{key:"executeAddIVx",value:function(e){this.i+=this.v[e],this.pc+=2}},{key:"executeHexVx",value:function(e){this.i=5*this.v[e],this.pc+=2}},{key:"executeBcdVx",value:function(e){this.memory[this.i]=this.v[e]/100,this.memory[this.i]=this.v[e]/10%10,this.memory[this.i]=this.v[e]%10,this.pc+=2}},{key:"executeSaveVx",value:function(e){var t=this;this.v.slice(0,e+1).forEach(function(e,i){t.memory[t.i+i]=e}),this.pc+=2}},{key:"executeRestoreVx",value:function(e){var t=this;this.memory.slice(this.i,this.i+e+1).forEach(function(e,i){t.v[i]=e}),this.pc+=2}}]),e}();t.default=y},function(e,t,i){"use strict";var n=i(2),r=[["demos",["Maze (alt) [David Winter, 199x]","Maze [David Winter, 199x]","Particle Demo [zeroZshadow, 2008]","Sierpinski [Sergey Naydenov, 2010]","Sirpinski [Sergey Naydenov, 2010]","Stars [Sergey Naydenov, 2010]","Trip8 Demo (2008) [Revival Studios]","Zero Demo [zeroZshadow, 2007]"]],["games",["15 Puzzle [Roger Ivie] (alt)","15 Puzzle [Roger Ivie]","Addition Problems [Paul C. Moews]","Airplane","Animal Race [Brian Astle]","Astro Dodge [Revival Studios, 2008]","Biorhythm [Jef Winsor]","Blinky [Hans Christian Egeberg, 1991]","Blinky [Hans Christian Egeberg] (alt)","Blitz [David Winter]","Bowling [Gooitzen van der Wal]","Breakout (Brix hack) [David Winter, 1997]","Breakout [Carmelo Cortez, 1979]","Brick (Brix hack, 1990)","Brix [Andreas Gustafsson, 1990]","Cave","Coin Flipping [Carmelo Cortez, 1978]","Connect 4 [David Winter]","Craps [Camerlo Cortez, 1978]","Deflection [John Fort]","Figures","Filter","Guess [David Winter] (alt)","Guess [David Winter]","Hi-Lo [Jef Winsor, 1978]","Hidden [David Winter, 1996]","Kaleidoscope [Joseph Weisbecker, 1978]","Landing","Lunar Lander (Udo Pernisz, 1979)","Mastermind FourRow (Robert Lindley, 1978)","Merlin [David Winter]","Missile [David Winter]","Most Dangerous Game [Peter Maruhnic]","Nim [Carmelo Cortez, 1978]","Paddles","Pong (1 player)","Pong (alt)","Pong 2 (Pong hack) [David Winter, 1997]","Pong [Paul Vervalin, 1990]","Programmable Spacefighters [Jef Winsor]","Puzzle","Reversi [Philip Baltzer]","Rocket Launch [Jonas Lindstedt]","Rocket Launcher","Rocket [Joseph Weisbecker, 1978]","Rush Hour [Hap, 2006] (alt)","Rush Hour [Hap, 2006]","Russian Roulette [Carmelo Cortez, 1978]","Sequence Shoot [Joyce Weisbecker]","Shooting Stars [Philip Baltzer, 1978]","Slide [Joyce Weisbecker]","Soccer","Space Flight","Space Intercept [Joseph Weisbecker, 1978]","Space Invaders [David Winter] (alt)","Space Invaders [David Winter]","Spooky Spot [Joseph Weisbecker, 1978]","Squash [David Winter]","Submarine [Carmelo Cortez, 1978]","Sum Fun [Joyce Weisbecker]","Syzygy [Roy Trevino, 1990]","Tank","Tapeworm [JDR, 1999]","Tetris [Fran Dachille, 1991]","Tic-Tac-Toe [David Winter]","Timebomb","Tron","UFO [Lutz V, 1992]","Vers [JMN, 1991]","Vertical Brix [Paul Robson, 1996]","Wall [David Winter]","Wipe Off [Joseph Weisbecker]","Worm V4 [RB-Revival Studios, 2007]","X-Mirror","ZeroPong [zeroZshadow, 2007]"]],["programs",["BMP Viewer - Hello (C8 example) [Hap, 2005]","Chip8 Picture","Chip8 emulator Logo [Garstyciuks]","Clock Program [Bill Fisher, 1981]","Delay Timer Test [Matthew Mikolay, 2010]","Division Test [Sergey Naydenov, 2010]","Fishie [Hap, 2005]","Framed MK1 [GV Samways, 1980]","Framed MK2 [GV Samways, 1980]","IBM Logo","Jumping X and O [Harry Kleinberg, 1977]","Keypad Test [Hap, 2006]","Life [GV Samways, 1980]","Minimal game [Revival Studios, 2007]","Random Number Test [Matthew Mikolay, 2010]","SQRT Test [Sergey Naydenov, 2010]"]]],s=[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(n.KEY_MAP.keys())),a=void 0,o=function(e){fetch(e).then(function(e){e.arrayBuffer().then(function(e){a.stopEmulation(),a.reset(),a.loadROM(new Uint8Array(e)),a.startEmulation()})})},u=function(e){e.target instanceof Element&&a.keyboard.pressedKeys.add(parseInt(e.target.innerHTML,16))},c=function(e){e.target instanceof Element&&a.keyboard.pressedKeys.delete(parseInt(e.target.innerHTML,16))},l=function(){var e=document.getElementById("chip8-rom-selector"),t=document.getElementById("chip8-canvas"),i=document.getElementById("chip8-keyboard");if(!(e instanceof HTMLSelectElement&&t instanceof HTMLCanvasElement&&null!=i))throw new Error("Could not initialize CHIP-8 UI. Some HTML elements are invalid or missing.");new Map(r).forEach(function(t,i){var n=document.createElement("optgroup");n instanceof HTMLOptGroupElement&&(n.label=i,e.add(n),t.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,n.appendChild(t)}))}),a=new n.UI({keyboardListener:document,canvas:t}),Array.from(i.children).forEach(function(e){e.addEventListener("mousedown",u),e.addEventListener("mouseup",c),e.addEventListener("mouseleave",c)}),window.addEventListener("keydown",function(e){var t=s.indexOf(e.key);t>=0&&i.children[t].classList.add("active")}),window.addEventListener("keyup",function(e){var t=s.indexOf(e.key);t>=0&&i.children[t].classList.remove("active")}),e.addEventListener("change",function(){var t=e.selectedOptions[0].parentNode;t instanceof HTMLOptGroupElement&&o("roms/"+t.label+"/"+e.value+".ch8")})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(0);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n(r).default}});var s=i(9);Object.defineProperty(t,"UI",{enumerable:!0,get:function(){return n(s).default}}),Object.defineProperty(t,"KEY_MAP",{enumerable:!0,get:function(){return s.KEY_MAP}})},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;n(this,e),this.width=t,this.height=i,this.pixels=new Uint8Array(t*i),this.isChanged=!1}return r(e,[{key:"reset",value:function(){this.pixels.fill(0),this.isChanged=!0}},{key:"getPixel",value:function(e,t){return this.pixels[e+t*this.width]}},{key:"flipPixel",value:function(e,t){this.pixels[e+t*this.width]^=1,this.isChanged=!0}}]),e}();t.default=s},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.OpcodeError=function(e){function t(e){n(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Invalid opcode: "+e));return i.name=i.constructor.name,i}return s(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error))},function(e,t,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){r(this,e),this.pressedKeys=new Set}return s(e,[{key:"getLatestPressedKey",value:function(){return this.pressedKeys.size>0?[].concat(n(this.pressedKeys)).pop():null}}]),e}();t.default=a},function(e,t,i){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4096,t=new Uint8Array(e);return t.set([240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128]),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;t.MEMORY_OFFSET_PROGRAM=512},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(){function e(){n(this,e),this.reset()}return r(e,[{key:"reset",value:function(){this.soundTimer=0,this.isBeeping=!1}},{key:"emulateCycle",value:function(){this.soundTimer>0?(this.soundTimer-=1,this.isBeeping=!0):this.isBeeping=!1}}]),e}();t.default=s},function(e,t,i){"use strict";function n(e,t){return Math.floor(Math.random()*(t-e))+e}Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomInt=n},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_MAP=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(0),u=function(e){return e&&e.__esModule?e:{default:e}}(o),c=t.KEY_MAP=new Map([["1",1],["2",2],["3",3],["4",12],["q",4],["w",5],["e",6],["r",13],["a",7],["s",8],["d",9],["f",14],["z",10],["x",0],["c",11],["v",15]]),l=function(e){function t(e){var i=e.keyboardListener,s=e.canvas,a=e.cpuFrequency,o=void 0===a?600:a;n(this,t);var u=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.addEventListener("keydown",function(e){var t=c.get(e.key);void 0!==t&&u.keyboard.pressedKeys.add(t)}),i.addEventListener("keyup",function(e){var t=c.get(e.key);void 0!==t&&u.keyboard.pressedKeys.delete(t)}),u.canvas=s,u.canvas.width=u.display.width,u.canvas.height=u.display.height,u.canvasContext=s.getContext("2d"),u.isAudioEnabled=!0;var l=new(AudioContext||window.webkitAudioContext);return u.audioMasterGain=l.createGain(),u.audioMasterGain.connect(l.destination),u.audioMasterGain.gain.value=0,u.audioOscillator=l.createOscillator(),u.audioOscillator.connect(u.audioMasterGain),u.audioOscillator.start(),u.cpuFrequency=o,u.cpuIntervalId=0,u.timersIntervalId=0,u}return s(t,e),a(t,[{key:"startEmulation",value:function(){var e=this;this.stopEmulation(),this.cpuIntervalId=setInterval(function(){for(var t=e.cpuFrequency/60;t>0;t-=1)e.emulateCycle()},1/60*1e3),this.timersIntervalId=setInterval(function(){e.updateTimers()},1/60*1e3),this.render()}},{key:"stopEmulation",value:function(){clearInterval(this.cpuIntervalId),clearInterval(this.timersIntervalId),this.cpuIntervalId=0,this.timersIntervalId=0}},{key:"render",value:function(){var e=this;0!==this.cpuIntervalId&&requestAnimationFrame(this.render.bind(this)),this.display.isChanged&&(this.display.isChanged=!1,this.display.pixels.forEach(function(t,i){var n=i%e.display.width,r=Math.trunc(i/e.display.width);t?e.canvasContext.fillRect(n,r,1,1):e.canvasContext.clearRect(n,r,1,1)})),this.audioMasterGain.gain.value=this.isAudioEnabled&&this.speaker.isBeeping?1:0}}]),t}(u.default);t.default=l}]);
//# sourceMappingURL=bundle.js.map